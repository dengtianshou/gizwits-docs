

# 中移ML302接入机智云方案及问题排查指引

## 修订历史

| 版本        | 修订内容    |  修订人  | 修订日期|
| :------:   | :-----:   | :----: |:----:|
| V1.0        |起稿      |   Bobo    |2020/08/06|


## 1.本文编写背景
本文主要介绍中国移动ML302-DNLM（以下略称中移ML302）模组如何快速从零开始接入机智云，实现简单的透传功能，以及常见的问题排查，还提供了该模组的相关资料。

## 2. 中移ML302模组资料下载及获取
中移ML302模组资料下载 ====> [点击下载](https://gizwits-doc-1251025085.cos.ap-guangzhou.myqcloud.com/ModuleData/4G-Module/CM-ML302/ML302-ModuleData.zip)

## 3. 中移ML302外围设计原理图

请下载第2章内容，参考《ML302_参考设计_V002_200424.pdf》推荐的外围设计原理图。

## 4. 中移ML302串口烧写固件说明

### 4.1、中移ML302固件获取与确认
当拿到一片中移ML302的模块的时候，若确认固件未烧写，请联系商务同事或FAE同事获取。拿到之后解压固件压缩包。

解压之后，会得到多个文件，里面的.pac文件就是我们烧写所要的文件。

>备注：本文固件名称以中移ML302_04030003版本固件为例，其他版本的模组固件名称的软硬件版本名字会有差异。

![中移ML302](/assets/zh-cn/deviceDev/ML302/ML302_1.png)


### 4.2、中移ML302硬件设备连接
中移ML302模块烧写需要按照手册正常接出电源，USB引脚，开机引脚，具体详细的接线方法可以参考文章第2章内容，参考《ML302_参考设计_V002_200424.pdf》和《ML302_硬件设计手册_V1.1.1.pdf》文档。

#### 4.2.1、中移ML302 USB引脚接线

ML302 模组支持 USB2.0 高速接口，兼容 USB2.0/USB1.1 协议，接口速率最大支持 480Mbps，不支持
OTG 模式，USB 输入/输出信号兼容 USB2.0 接口规范。

![中移ML302](/assets/zh-cn/deviceDev/ML302/ML302_2.png)

ML302 支持 USB 升级下载功能。用户可以在模组开机前将 USB_BOOT 上拉至 1.8V，在开机时模组将进
入下载模式。在此模式下，模组可通过 USB 接口进行固件升级下载。

![中移ML302](/assets/zh-cn/deviceDev/ML302/ML302_3.png)


#### 4.2.2、中移ML302 电源参考电路

为保证 ML302 模组正常工作，系统电源 VBAT 需要保证在 3.3-4.3V（典型 3.8V）范围内。当 ML302 用
于不同的外部设备的时候，需要注意模组的供电设计。当模组在 4G 网络最大发射功率下工作时，现网下的瞬
态工作电流能达到 2A，在 GSM 模式下，峰值电流可以达到 2.75A，并可能引起电源电压跌落。在任何情况
下，需要保证模组电源电压不能低于 3.3V，否则模组可能会出现重启等意外状况。

外部供电 LDO 或者 DCDC 选型建议器件能够输出 3A 以上电流，而且在 VBAT 上至少并联 5 颗 220uF
储能电容。另外，为了 PCB 走线路对供电电压的影响，需要 VBAT 走线尽量短，尽量宽。建议在 VBAT 上设
计一颗磁珠，隔离 DTE 对模组的干扰。示意图如下所示。

![Alt text](/assets/zh-cn/deviceDev/ML302/ML302_4.png)


#### 4.2.3、中移ML302 开机引脚设计

当 ML302 模组处于关机模式，可以通过拉低 PWR_KEY 至少 2s 使模组开机。推荐使用开集电路实现控
制拉低。

开关机接口示意图如下所示。

![Alt text](/assets/zh-cn/deviceDev/ML302/ML302_5.png)

### 4.3、中移ML302 确认串口参数

根据文章4.2.1，将上述USB口连接电脑后，再根据文章4.2.3章节，使模组开机。通过“我的电脑”->“管理”-> “设备管理器”->“端口（COM 和LPT）”选项中可以看到相应增加的COM口。

>*备注：若链接USB后出现未识别的端口，请打开本文章节二下载的文件，根据系统版本安装模组驱动文件夹内的驱动。*

![Alt text](/assets/zh-cn/deviceDev/ML302/ML302_6.png)

### 4.4、中移ML302的烧写

1、当USB正常连接成功之后，从本文第2章节获取资料，获得烧录工具《UPGRADEDOWNLOAD_R22.19.1701.rar》。

2、解压打开bin文件夹之后，双击<UpgradeDownload.exe>应用程序文件，点击左上角齿轮按钮，选择固件包内的.pac文件

![Alt text](/assets/zh-cn/deviceDev/ML302/ML302_7.png)

3、点击开始按键进行烧录。

![Alt text](/assets/zh-cn/deviceDev/ML302/ML302_8.png)

4、稍等片刻，烧写完之后会重启设备，期间需要保持电源正常供电，显示PASS则固件烧写成功
> 注：若此时进行断电或者拔插USB接口会导致模组损坏的情况！需保持正常供电，直至烧写成功后，点击暂停按钮

![Alt text](/assets/zh-cn/deviceDev/ML302/ML302_9.png)


## 5、中移ML302模组日志抓取

### 5.1、中移ML302模组日志接线方法
按照中移ML302的管脚定义图，将图中所示的15引脚（芯片调试日志信息输出口）连接USB转TTL工具的RXD上，且USB转TTL工具的GND需接模组的GND，然后将USB转TTL工具连接到电脑，确认端口。

![Alt text](/assets/zh-cn/deviceDev/ML302/ML302_10.png)

- **通信串口：**

| 管脚号 | 管脚名 | 描述 |
| :-: | :-: | :-: |
| 29 | UART0_TXD | 串口0 发送数据 |
| 30 | UART0_RXD | 串口0 接收数据 |

- **日志串口：**

| 管脚号 | 管脚名 | 描述 |
| :-: | :-: | :-: |
| 14 | UART2_RXD | 串口2 接收数据 |
| 15 | UART2_TXD | 串口2 发送数据 |


- **串口设计图：**

![Alt text](/assets/zh-cn/deviceDev/ML302/ML302_11.png)

### 5.2、机智云串口打印软件工具的获取与使用

1. 按照文章5.1的管脚定义图，将图中所示的15（UART2_TXD）（芯片调试日志信息输出口）通过USB转TTL工具连接到电脑，且USB转TTL工具的GND需接模组的GND，波特率115200bps。

2. 机智云串口打印软件工具下载链接：链接：https://eyun.baidu.com/s/3oAbSruq 密码：pPsL

3. 机智云 中移ML302 固件版本号为：04030001版本或更高级版本，模组串口日志打印为加密，需要使用对应版本号的.mapTab文件解码。对应的解码文件在章节2进行下载获取。

![Alt text](/assets/zh-cn/deviceDev/ML302/ML302_12.png)

## 6.搭配gokit接入机智云（包含创建数据点，下载代码，demoAPP扫码绑定及控制设备等等）
快速接入文档参考链接：http://docs.gizwits.com/zh-cn/deviceDev/debug/G510_Project.html

>备注：模组uart为与Gokit通讯的通讯串口，通讯波特率为9600bps，具体可参考文章5.1的模组接线方法图

## 7.FAQ

1、Q:模组已经和MCU正常接线，但是无法进行通讯。

 A:1、确认5.1章节，模组的通讯引脚是否接对。需要使用29、30引脚和MCU进行通讯。2、确认5.1章节的串口设计图，大部分MCU的串口是3.3V，需要根据模组串口电压范围，做电平转换。
