title: 广和通G510模组接入方案
-------

# 概述
   G510是广和通推出的一款基于GPRS的通讯模组，本篇通过讲述如何通过G510模组把MCU接入到机智云云端，并实现通讯的方案。全篇文章的内容包括G510模组的管脚介绍、SIM卡连接、供电要求、串口定义以及固件烧写方法等，合作厂商在进行设备接入时请参照以下资料进行，以免造成不可控的错误。
# 模组接入准备
## G510模组管脚图
![Alt text](/assets/zh-cn/deviceDev/debug/G510/1482753663131.png)

## SIM卡连接方法
模块包含了一个 SIM 卡接口，这个接口符合 GSM 11.11 和 GSM 11.12 标准（基于 ISO/IEC 7816） 。

这些标准定义了 GSM SIM 卡的电气特性、 信令和协议规范。

模块不包含 SIM 卡槽。SIM 卡槽必须放在模块外部的用户开发板上。模块的 SIM 卡接口包括了所有必须的信号，这些信号被接到接口连接器，直接并全部连接到外部的 SIM 卡。模块支持 1.8V 或者 2.85V 电平自动识别。当模块在开机后，首先 SIM_VCC 向外部 SIM 卡输出 1.8V电压来建立通信。如果通信不成功，SIM_VCC 会再次输出 2.85V 电压，并和 SIM 卡建立通信。

![Alt text](/assets/zh-cn/deviceDev/debug/G510/1482754308693.png)


下图显示了一个典型的 SIM 卡接口，连接到模块。在模块开发板上，使用 MOLEX （PN 912283001 &912360001）SIM 卡槽，来实现这种连接方式。

无论 SIM_CD 是否使用，都必须上拉，保证 SIM 卡的检测稳定。模块内部已经将 SIM_DATA 信号上拉到 SIM_VCC，外围无需再上拉。

![Alt text](/assets/zh-cn/deviceDev/debug/G510/1482754330995.png)


SIM 卡接口和信号的设计特别重要。为了满足设计标准和规定，以下几点是必须要遵循的设计准则：


+ SIM 卡的位置以及 SIM 信号的走线，必须远离任何可能的电磁干扰源，像射频天线和数字开关信号等。

+ 在模块接口连接器和 SIM 卡槽之间，SIM 卡走线长度不应超过 100mm，这样满足 EMC 法则，同时提供信号的完整性。

+ 为了避免 SIM 卡时钟和数据信号 （SIM_CLK 和 SIM_DATA） 之间的串扰，建议在开发板上将它们隔开，最好是由大地隔开。

+ SIM 卡信号应使用低容性的保护性元器件进行 ESD 保护。建议使用 AVR M1005C270MAAB(TDK) ，并且 ESD 器件应该布局在 SIM 卡的附近

## 电源接入管理
模块必须由外部3.3V 到4.5V的直流电源单独供电， 而且电源必须在此电压下允许有 2.0A 的电流通过，此电流只是在 GSM 的时隙发送时的瞬态电流。 模块提供 2 个管脚由外部来供电，如下表

|管脚号         | 管脚名           | 描述  |
| ------------- |:-------------:| :-----|
| 9      |VBAT | 直流电源 VBAT = 3.3 V to 4.5 V|
| 10      |  VBAT | 推荐电源电压：4.0V  |


GSM 是时分多址，在发送时隙时会导致瞬时电流波动，由此会出现电压纹波现象。此时如果不处理妥当，这些频繁的电压纹波将会降低模块的性能。建议将此纹波控制在 300mV 以内。在任何情况下，模块的供电都不应该低于它的最小电压。为了降低纹波等对电源的影响，我们建议：
+ 在模块的电源输入端使用一颗1000uF或者更大的， 低ESR的电容。 这颗电容， 越靠近模块的VBAT管脚越好。
+ 使用低阻的电源，电源线和 LAYOUT 走线。
+ 电源走线越短越好。
+ 使用滤波电容给模块的供电滤波，如下表：

|推荐的容值        | 功能           | 描述  |
| ------------- |:-------------:| :-----|
|1000 uF      |电流纹波 |降低发送时隙时对电源的影响，尽可能使用大容量电容|
| 10 nF, 100 nF    |  数字开关噪声 | 滤除由时钟，数字信号引起的噪声 |
|8.2 pF, 10 p    |  DCS1800/PCS1900 MHz GSM 频段 | 滤除由 GSM 高频段传输中带来的杂波 |
|33 pF, 39 pF    |GSM850/GSM900 MHz GSM 频段 | 滤除由 GSM 低频段传输中带来的杂波 |

## 串口的定义和使用
G510 有 3 个 UART 串口。

+ UART1 是一个完全独立的 8 线串行通信接口 (UART1). 这是主串口。默认端口配置为115200bps、 8 个数据位、1 个停止位和无奇偶校验。主要用于固件下载、log打印等。

|管脚号         | 管脚名           | 描述  |性能  |
| ------------- |:-------------:| :-----|:----- |
| 19     |UART1_TXD | 模块发送数据|模块发送数据  |
| 18      | UART1_RXD | 推模块接收数据 |模块接收数据 |
| 21      |  UART1_CTS | 清空发送  |模块切换接收 |
| 20      |  UART1_RTS | 请求发送  |模块提醒 DTE 接收  |

+ UART2 是一个 2 线串口，只支持部分 AT 命令，用于和MCU通信。UART 2 默认端口配置为 115200bps、8 个数据位、1 个停止位和无奇偶校验。

|管脚号         | 管脚名           | 描述  |性能  |
| ------------- |:-------------:| :-----|:----- |
| 40     |UART1_TXD | 模块发送数据|G510发送数据  |
| 39      | UART1_RXD | 推模块接收数据 |G510接收数据 |

+ HOST UART 是个 Debug UART，主要用来下载，校准，Trace 等，不支持 AT 命令。此口只在生产调试时使用，用户只需接测试点。

## 模组参考资料与工具
如需获取更多的G510模组参考资料，请点击以下链接进行下载：

[点击下载](https://gizwits-doc-1251025085.cos.ap-guangzhou.myqcloud.com/ModuleData/2G-Module/FIBOCOM-G510/G510-ModuleData.zip)

# 搭建固件烧写环境

## 焊接对应管脚
G510模组电路焊接：参照下方电路图，使用杜邦线连接以下管脚

| 管脚         |  参数     |
| ------------- |:-------------:|
| 1      |  GND |
| 10     |  VBAT      |
| 19    | UART1_TXD     |
| 18    | UART1_RXD     |
| 14   | POWER_ON     |



## 连接模组

电脑插入USB转TTL串口模块，查看模块所在COM口

![Alt text](/assets/zh-cn/deviceDev/debug/G510/1482753675007.png)


使用杜邦线将USB转TTL串口模块与焊接好的G510模组连接。

![Alt text](/assets/zh-cn/deviceDev/debug/G510/1482753870813.png)

## 下载固件与烧写工具

下载G510的相对应的GAgent固件，打开烧写工具Fibocom_upgrade V1.3。

![Alt text](/assets/zh-cn/deviceDev/debug/G510/1482753911061.png)

# 烧写过程

## 步骤1.切断电源

先断开模组的供电（可拨掉VCC的杜邦线）。

## 步骤2.配置烧写软件

按照下图配置Fibocom_upgrade V1.3

![Alt text](/assets/zh-cn/deviceDev/debug/G510/1482753930052.png)

## 步骤3.进入烧写

重新接上模组的VCC供电，把power_on打到低电平（接GND），烧写工具会自动运行。

如果烧写失败，可能是模组还没开机，检查G510 开关机状态，VDD管脚电平为 0V 时，G510 处于关机状态，电平大于 2.85V 时，G510 处于开机状态。

当 POWER_ON 管脚信号为低电平并且持续超过 800ms 时，模块将开机。

![Alt text](/assets/zh-cn/deviceDev/debug/G510/1482753947372.png)

# 效果验证
1.使用杜邦线将USB转TTL串口模块与G510模组的UART2（注意:和烧录固件的不是同一串口）连接。

| G510模组管脚 | 连接USB转TTL管脚    |
| ------------- |:-------------:|
| 1:GND      |  GND |
| 10：VBAT     |  VCC      |
| 39：UART2_RXD	  | TXD      |
|40：UART2_TXD| RXD|

2.使用机智云XPG助手模拟MCU功能。

按照下图配置，更多使用方法[请点击这里](http://docs.gizwits.com/zh-cn/deviceDev/%E4%B8%B2%E5%8F%A3%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3.html)

![Alt text](/assets/zh-cn/deviceDev/debug/G510/1482812677989.png)

3.另外，可以再增加一个USB转TTL模块，通过接G510的UART1串口来输出LOG日志，可以看见G510连接GAgent的过程。

| G510模组管脚|连接USB转TTL管脚 |
| ------------- |:-------------:|
| 1:GND      |  GND |
| 18：UART1_RXD     |  TXD      |
| 19：UART1_TXD     | RXD     |

注：波特率为：115200

注意：由于没有连接SIM卡，所以模组无法真正的连上网络，会一直报错。

![Alt text](/assets/zh-cn/deviceDev/debug/G510/1482754299767.png)

# 搭配gokit接入机智云

（包含创建数据点，下载代码，demoAPP配网绑定及控制设备等等）

快速接入文档参考链接：http://docs.gizwits.com/zh-cn/deviceDev/debug/G510_Project.html

> 备注：模组的串口2，UART2_RXD(RXD)与UART2_TXD(TXD)为与Gokit通讯的通讯串口，通讯波特率为9600bps，具体引脚可以参考“G510模组管脚图”
